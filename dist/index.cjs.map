{"version":3,"sources":["../src/core/errors/index.ts","../src/core/http/client.ts","../src/core/resources/service-invoices.ts","../src/core/resources/companies.ts","../src/core/resources/index.ts","../src/core/client.ts","../src/index.ts"],"names":["APIError","AuthenticationError","BadRequestError","ConfigurationError","ConflictError","ConnectionError","ErrorFactory","ErrorTypes","InternalServerError","InvoiceProcessingError","NfeError","NotFoundError","PollingTimeoutError","RateLimitError","ServerError","TimeoutError","ValidationError","NfeClient","SUPPORTED_NODE_VERSIONS","VERSION","init_client","process"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\r\n * NFE.io SDK v3 - Error Classes\r\n * \r\n * Comprehensive error handling system that maintains compatibility\r\n * with v2 error types while providing modern TypeScript benefits\r\n */\r\n\r\n// ============================================================================\r\n// Base Error Class\r\n// ============================================================================\r\n\r\nexport class NfeError extends Error {\r\n  public readonly type: string = 'NfeError';\r\n  public readonly code?: number | undefined;\r\n  public readonly details?: unknown;\r\n  public readonly raw?: unknown;\r\n\r\n  constructor(message: string, details?: unknown, code?: number) {\r\n    super(message);\r\n    this.name = this.constructor.name;\r\n    this.code = code;\r\n    this.details = details;\r\n    this.raw = details;\r\n\r\n    // Ensure proper prototype chain for instanceof checks\r\n    Object.setPrototypeOf(this, new.target.prototype);\r\n\r\n    // Capture stack trace if available (Node.js specific)\r\n    if ('captureStackTrace' in Error && typeof (Error as any).captureStackTrace === 'function') {\r\n      (Error as any).captureStackTrace(this, this.constructor);\r\n    }\r\n  }\r\n\r\n  /** Convert error to JSON for logging/debugging */\r\n  toJSON() {\r\n    return {\r\n      type: this.type,\r\n      name: this.name,\r\n      message: this.message,\r\n      code: this.code,\r\n      details: this.details,\r\n      stack: this.stack,\r\n    };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// HTTP-specific Errors (maintain v2 compatibility)\r\n// ============================================================================\r\n\r\nexport class AuthenticationError extends NfeError {\r\n  public override readonly type = 'AuthenticationError';\r\n\r\n  constructor(message = 'Invalid API key or authentication failed', details?: unknown) {\r\n    super(message, details, 401);\r\n  }\r\n}\r\n\r\nexport class ValidationError extends NfeError {\r\n  public override readonly type = 'ValidationError';\r\n\r\n  constructor(message = 'Invalid request data', details?: unknown) {\r\n    super(message, details, 400);\r\n  }\r\n}\r\n\r\nexport class NotFoundError extends NfeError {\r\n  public override readonly type = 'NotFoundError';\r\n\r\n  constructor(message = 'Resource not found', details?: unknown) {\r\n    super(message, details, 404);\r\n  }\r\n}\r\n\r\nexport class ConflictError extends NfeError {\r\n  public override readonly type = 'ConflictError';\r\n\r\n  constructor(message = 'Resource conflict', details?: unknown) {\r\n    super(message, details, 409);\r\n  }\r\n}\r\n\r\nexport class RateLimitError extends NfeError {\r\n  public override readonly type = 'RateLimitError';\r\n\r\n  constructor(message = 'Rate limit exceeded', details?: unknown) {\r\n    super(message, details, 429);\r\n  }\r\n}\r\n\r\nexport class ServerError extends NfeError {\r\n  public override readonly type = 'ServerError';\r\n\r\n  constructor(message = 'Internal server error', details?: unknown, code = 500) {\r\n    super(message, details, code);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Connection/Network Errors\r\n// ============================================================================\r\n\r\nexport class ConnectionError extends NfeError {\r\n  public override readonly type = 'ConnectionError';\r\n\r\n  constructor(message = 'Connection error', details?: unknown) {\r\n    super(message, details);\r\n  }\r\n}\r\n\r\nexport class TimeoutError extends NfeError {\r\n  public override readonly type = 'TimeoutError';\r\n\r\n  constructor(message = 'Request timeout', details?: unknown) {\r\n    super(message, details);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SDK-specific Errors\r\n// ============================================================================\r\n\r\nexport class ConfigurationError extends NfeError {\r\n  public override readonly type = 'ConfigurationError';\r\n\r\n  constructor(message = 'SDK configuration error', details?: unknown) {\r\n    super(message, details);\r\n  }\r\n}\r\n\r\nexport class PollingTimeoutError extends NfeError {\r\n  public override readonly type = 'PollingTimeoutError';\r\n\r\n  constructor(message = 'Polling timeout - operation still in progress', details?: unknown) {\r\n    super(message, details);\r\n  }\r\n}\r\n\r\nexport class InvoiceProcessingError extends NfeError {\r\n  public override readonly type = 'InvoiceProcessingError';\r\n\r\n  constructor(message = 'Invoice processing failed', details?: unknown) {\r\n    super(message, details);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Error Factory (maintains v2 compatibility)\r\n// ============================================================================\r\n\r\nexport class ErrorFactory {\r\n  /**\r\n   * Create error from HTTP response (maintains v2 ResourceError.generate pattern)\r\n   */\r\n  static fromHttpResponse(status: number, data?: unknown, message?: string): NfeError {\r\n    const errorMessage = message || this.getDefaultMessage(status);\r\n\r\n    switch (status) {\r\n      case 400:\r\n        return new ValidationError(errorMessage, data);\r\n      case 401:\r\n        return new AuthenticationError(errorMessage, data);\r\n      case 404:\r\n        return new NotFoundError(errorMessage, data);\r\n      case 409:\r\n        return new ConflictError(errorMessage, data);\r\n      case 429:\r\n        return new RateLimitError(errorMessage, data);\r\n      case 500:\r\n      case 502:\r\n      case 503:\r\n      case 504:\r\n        return new ServerError(errorMessage, data, status);\r\n      default:\r\n        if (status >= 400 && status < 500) {\r\n          return new ValidationError(errorMessage, data);\r\n        }\r\n        if (status >= 500) {\r\n          return new ServerError(errorMessage, data, status);\r\n        }\r\n        return new NfeError(errorMessage, data, status);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create error from fetch/network issues\r\n   */\r\n  static fromNetworkError(error: Error): NfeError {\r\n    if (error.name === 'AbortError' || error.message.includes('timeout')) {\r\n      return new TimeoutError('Request timeout', error);\r\n    }\r\n\r\n    if (error.message.includes('fetch')) {\r\n      return new ConnectionError('Network connection failed', error);\r\n    }\r\n\r\n    return new ConnectionError('Connection error', error);\r\n  }\r\n\r\n  /**\r\n   * Create error from Node.js version check\r\n   */\r\n  static fromNodeVersionError(nodeVersion: string): ConfigurationError {\r\n    return new ConfigurationError(\r\n      `NFE.io SDK v3 requires Node.js 18+ (for native fetch support). Current version: ${nodeVersion}`,\r\n      { nodeVersion, requiredVersion: '>=18.0.0' }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create error from missing API key\r\n   */\r\n  static fromMissingApiKey(): ConfigurationError {\r\n    return new ConfigurationError(\r\n      'API key is required. Pass it in NfeConfig or set NFE_API_KEY environment variable.',\r\n      { configField: 'apiKey' }\r\n    );\r\n  }\r\n\r\n  private static getDefaultMessage(status: number): string {\r\n    const messages: Record<number, string> = {\r\n      400: 'Invalid request data',\r\n      401: 'Invalid API key or authentication failed',\r\n      403: 'Access forbidden',\r\n      404: 'Resource not found',\r\n      409: 'Resource conflict',\r\n      429: 'Rate limit exceeded',\r\n      500: 'Internal server error',\r\n      502: 'Bad gateway',\r\n      503: 'Service unavailable',\r\n      504: 'Gateway timeout',\r\n    };\r\n\r\n    return messages[status] || `HTTP ${status} error`;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Error Type Guards\r\n// ============================================================================\r\n\r\nexport function isNfeError(error: unknown): error is NfeError {\r\n  return error instanceof NfeError;\r\n}\r\n\r\nexport function isAuthenticationError(error: unknown): error is AuthenticationError {\r\n  return error instanceof AuthenticationError;\r\n}\r\n\r\nexport function isValidationError(error: unknown): error is ValidationError {\r\n  return error instanceof ValidationError;\r\n}\r\n\r\nexport function isNotFoundError(error: unknown): error is NotFoundError {\r\n  return error instanceof NotFoundError;\r\n}\r\n\r\nexport function isConnectionError(error: unknown): error is ConnectionError {\r\n  return error instanceof ConnectionError;\r\n}\r\n\r\nexport function isTimeoutError(error: unknown): error is TimeoutError {\r\n  return error instanceof TimeoutError;\r\n}\r\n\r\nexport function isPollingTimeoutError(error: unknown): error is PollingTimeoutError {\r\n  return error instanceof PollingTimeoutError;\r\n}\r\n\r\n// ============================================================================\r\n// Legacy Aliases (for v2 compatibility)\r\n// ============================================================================\r\n\r\n/** @deprecated Use ValidationError instead */\r\nexport const BadRequestError = ValidationError;\r\n\r\n/** @deprecated Use NfeError instead */\r\nexport const APIError = NfeError;\r\n\r\n/** @deprecated Use ServerError instead */\r\nexport const InternalServerError = ServerError;\r\n\r\n// Export all error types\r\nexport const ErrorTypes = {\r\n  NfeError,\r\n  AuthenticationError,\r\n  ValidationError,\r\n  NotFoundError,\r\n  ConflictError,\r\n  RateLimitError,\r\n  ServerError,\r\n  ConnectionError,\r\n  TimeoutError,\r\n  ConfigurationError,\r\n  PollingTimeoutError,\r\n  InvoiceProcessingError,\r\n  // Legacy aliases\r\n  BadRequestError,\r\n  APIError,\r\n  InternalServerError,\r\n} as const;\r\n\r\nexport type ErrorType = keyof typeof ErrorTypes;","/**\r\n * NFE.io SDK v3 - HTTP Client with Fetch API\r\n * \r\n * Modern HTTP client using native fetch (Node.js 18+)  \r\n * Zero external dependencies with automatic retries and proper error handling\r\n */\r\n\r\nimport type { HttpConfig, HttpResponse, RetryConfig } from '../types.js';\r\nimport { \r\n  ErrorFactory, \r\n  ConnectionError, \r\n  TimeoutError, \r\n  RateLimitError,\r\n  type NfeError \r\n} from '../errors/index.js';\r\n\r\n// Simple type declarations for runtime APIs\r\ndeclare const fetch: any;\r\ndeclare const AbortController: any;\r\ndeclare const URLSearchParams: any;\r\ndeclare const FormData: any;\r\ndeclare const setTimeout: any;\r\ndeclare const clearTimeout: any;\r\ndeclare const Buffer: any;\r\ndeclare const process: any;\r\n\r\n// ============================================================================\r\n// HTTP Client Implementation\r\n// ============================================================================\r\n\r\nexport class HttpClient {\r\n  private readonly config: HttpConfig;\r\n\r\n  constructor(config: HttpConfig) {\r\n    this.config = config;\r\n    this.validateFetchSupport();\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Public HTTP Methods\r\n  // --------------------------------------------------------------------------\r\n\r\n  async get<T = unknown>(path: string, params?: Record<string, unknown>): Promise<HttpResponse<T>> {\r\n    const url = this.buildUrl(path, params);\r\n    return this.request<T>('GET', url);\r\n  }\r\n\r\n  async post<T = unknown>(path: string, data?: unknown): Promise<HttpResponse<T>> {\r\n    const url = this.buildUrl(path);\r\n    return this.request<T>('POST', url, data);\r\n  }\r\n\r\n  async put<T = unknown>(path: string, data?: unknown): Promise<HttpResponse<T>> {\r\n    const url = this.buildUrl(path);\r\n    return this.request<T>('PUT', url, data);\r\n  }\r\n\r\n  async delete<T = unknown>(path: string): Promise<HttpResponse<T>> {\r\n    const url = this.buildUrl(path);\r\n    return this.request<T>('DELETE', url);\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Core Request Method with Retry Logic\r\n  // --------------------------------------------------------------------------\r\n\r\n  private async request<T>(\r\n    method: string, \r\n    url: string, \r\n    data?: unknown\r\n  ): Promise<HttpResponse<T>> {\r\n    const { maxRetries, baseDelay } = this.config.retryConfig;\r\n    let lastError: NfeError | undefined;\r\n\r\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        const response = await this.executeRequest<T>(method, url, data);\r\n        return response;\r\n      } catch (error) {\r\n        lastError = error as NfeError;\r\n\r\n        // Don't retry on client errors (4xx) except rate limits\r\n        if (this.shouldNotRetry(lastError, attempt, maxRetries)) {\r\n          throw lastError;\r\n        }\r\n\r\n        // Wait before retry (exponential backoff)\r\n        if (attempt < maxRetries) {\r\n          const delay = this.calculateRetryDelay(attempt, baseDelay);\r\n          await this.sleep(delay);\r\n        }\r\n      }\r\n    }\r\n\r\n    throw lastError || new ConnectionError('Request failed after all retries');\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Single Request Execution\r\n  // --------------------------------------------------------------------------\r\n\r\n  private async executeRequest<T>(\r\n    method: string,\r\n    url: string,\r\n    data?: unknown\r\n  ): Promise<HttpResponse<T>> {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), this.config.timeout);\r\n\r\n    try {\r\n      const headers = this.buildHeaders(data);\r\n      const body = this.buildBody(data);\r\n\r\n      const response = await fetch(url, {\r\n        method: method.toUpperCase(),\r\n        headers,\r\n        body,\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n\r\n      return await this.processResponse<T>(response);\r\n\r\n    } catch (error) {\r\n      clearTimeout(timeoutId);\r\n\r\n      if (error instanceof Error) {\r\n        if (error.name === 'AbortError') {\r\n          throw new TimeoutError(`Request timeout after ${this.config.timeout}ms`, error);\r\n        }\r\n        throw ErrorFactory.fromNetworkError(error);\r\n      }\r\n\r\n      throw new ConnectionError('Unknown network error', error);\r\n    }\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Response Processing\r\n  // --------------------------------------------------------------------------\r\n\r\n  private async processResponse<T>(response: any): Promise<HttpResponse<T>> {\r\n    // Special handling for NFE.io async responses (202 with location)\r\n    if (response.status === 202) {\r\n      const location = response.headers.get('location');\r\n      if (location) {\r\n        return {\r\n          data: {\r\n            code: 202,\r\n            status: 'pending',\r\n            location\r\n          } as T,\r\n          status: response.status,\r\n          headers: this.extractHeaders(response)\r\n        };\r\n      }\r\n    }\r\n\r\n    // Handle error responses\r\n    if (!response.ok) {\r\n      await this.handleErrorResponse(response);\r\n    }\r\n\r\n    // Parse successful response\r\n    const data = await this.parseResponseData<T>(response);\r\n\r\n    return {\r\n      data,\r\n      status: response.status,\r\n      headers: this.extractHeaders(response)\r\n    };\r\n  }\r\n\r\n  private async parseResponseData<T>(response: any): Promise<T> {\r\n    const contentType = response.headers.get('content-type') || '';\r\n\r\n    if (contentType.includes('application/json')) {\r\n      return response.json() as Promise<T>;\r\n    }\r\n\r\n    if (contentType.includes('application/pdf') || contentType.includes('application/xml')) {\r\n      const buffer = await response.arrayBuffer();\r\n      return Buffer.from(buffer) as unknown as T;\r\n    }\r\n\r\n    // Default to text\r\n    return response.text() as unknown as T;\r\n  }\r\n\r\n  private async handleErrorResponse(response: any): Promise<never> {\r\n    let errorData: unknown;\r\n    \r\n    try {\r\n      const contentType = response.headers.get('content-type') || '';\r\n      if (contentType.includes('application/json')) {\r\n        errorData = await response.json();\r\n      } else {\r\n        errorData = await response.text();\r\n      }\r\n    } catch {\r\n      // Ignore parse errors, use status as fallback\r\n      errorData = { status: response.status, statusText: response.statusText };\r\n    }\r\n\r\n    // Extract error message from response data\r\n    const message = this.extractErrorMessage(errorData, response.status);\r\n    \r\n    throw ErrorFactory.fromHttpResponse(response.status, errorData, message);\r\n  }\r\n\r\n  private extractErrorMessage(data: unknown, status: number): string {\r\n    if (typeof data === 'object' && data !== null) {\r\n      const errorObj = data as Record<string, unknown>;\r\n      \r\n      // Try common error message fields\r\n      if (typeof errorObj.message === 'string') return errorObj.message;\r\n      if (typeof errorObj.error === 'string') return errorObj.error;\r\n      if (typeof errorObj.detail === 'string') return errorObj.detail;\r\n      if (typeof errorObj.details === 'string') return errorObj.details;\r\n    }\r\n\r\n    if (typeof data === 'string') {\r\n      return data;\r\n    }\r\n\r\n    return `HTTP ${status} error`;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // URL and Header Building\r\n  // --------------------------------------------------------------------------\r\n\r\n  private buildUrl(path: string, params?: Record<string, unknown>): string {\r\n    const baseUrl = this.config.baseUrl.replace(/\\/$/, ''); // Remove trailing slash\r\n    const cleanPath = path.replace(/^\\//, ''); // Remove leading slash\r\n    let url = `${baseUrl}/${cleanPath}`;\r\n\r\n    if (params && Object.keys(params).length > 0) {\r\n      const searchParams = new URLSearchParams();\r\n      for (const [key, value] of Object.entries(params)) {\r\n        if (value !== undefined && value !== null) {\r\n          searchParams.append(key, String(value));\r\n        }\r\n      }\r\n      const queryString = searchParams.toString();\r\n      if (queryString) {\r\n        url += `?${queryString}`;\r\n      }\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private buildHeaders(data?: unknown): Record<string, string> {\r\n    const headers: Record<string, string> = {\r\n      'Authorization': `Basic ${Buffer.from(this.config.apiKey).toString('base64')}`,\r\n      'Accept': 'application/json',\r\n      'User-Agent': this.getUserAgent(),\r\n    };\r\n\r\n    // Add Content-Type for requests with body (but not FormData)\r\n    if (data !== undefined && data !== null && !this.isFormData(data)) {\r\n      headers['Content-Type'] = 'application/json';\r\n    }\r\n\r\n    return headers;\r\n  }\r\n\r\n  private buildBody(data?: unknown): string | any | undefined {\r\n    if (data === undefined || data === null) {\r\n      return undefined;\r\n    }\r\n\r\n    // Handle FormData (for file uploads)\r\n    if (this.isFormData(data)) {\r\n      return data as any;\r\n    }\r\n\r\n    // Default to JSON\r\n    return JSON.stringify(data);\r\n  }\r\n\r\n  private isFormData(data: unknown): boolean {\r\n    return typeof FormData !== 'undefined' && data instanceof FormData;\r\n  }\r\n\r\n  private getUserAgent(): string {\r\n    const nodeVersion = process.version;\r\n    const platform = process.platform;\r\n    \r\n    // Try to get package version (will be undefined in development)\r\n    const packageVersion = '3.0.0-beta.1'; // TODO: Read from package.json\r\n    \r\n    return `@nfe-io/sdk@${packageVersion} node/${nodeVersion} (${platform})`;\r\n  }\r\n\r\n  private extractHeaders(response: any): Record<string, string> {\r\n    const headers: Record<string, string> = {};\r\n    response.headers.forEach((value: any, key: any) => {\r\n      headers[key] = value;\r\n    });\r\n    return headers;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Retry Logic\r\n  // --------------------------------------------------------------------------\r\n\r\n  private shouldNotRetry(error: NfeError, attempt: number, maxRetries: number): boolean {\r\n    // Don't retry if we've exhausted attempts\r\n    if (attempt >= maxRetries) {\r\n      return true;\r\n    }\r\n\r\n    // Always retry rate limits (with backoff)\r\n    if (error instanceof RateLimitError) {\r\n      return false;\r\n    }\r\n\r\n    // Don't retry client errors (4xx) except authentication (might be temporary)\r\n    if (error.code && error.code >= 400 && error.code < 500) {\r\n      return error.code !== 401; // Retry auth errors once\r\n    }\r\n\r\n    // Retry server errors (5xx) and network errors\r\n    return false;\r\n  }\r\n\r\n  private calculateRetryDelay(attempt: number, baseDelay: number): number {\r\n    const { maxDelay = 30000, backoffMultiplier = 2 } = this.config.retryConfig;\r\n    \r\n    // Exponential backoff with jitter\r\n    const exponentialDelay = baseDelay * Math.pow(backoffMultiplier, attempt);\r\n    const jitter = Math.random() * 0.1 * exponentialDelay; // 10% jitter\r\n    \r\n    return Math.min(exponentialDelay + jitter, maxDelay);\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Validation\r\n  // --------------------------------------------------------------------------\r\n\r\n  private validateFetchSupport(): void {\r\n    if (typeof fetch === 'undefined') {\r\n      throw ErrorFactory.fromNodeVersionError(process.version);\r\n    }\r\n\r\n    if (typeof AbortController === 'undefined') {\r\n      throw new ConnectionError(\r\n        'AbortController is not available. This should not happen in Node.js 18+.'\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// HTTP Client Factory\r\n// ============================================================================\r\n\r\nexport function createHttpClient(config: HttpConfig): HttpClient {\r\n  return new HttpClient(config);\r\n}\r\n\r\n// ============================================================================\r\n// Utility Functions\r\n// ============================================================================\r\n\r\n/**\r\n * Create default retry configuration\r\n */\r\nexport function createDefaultRetryConfig(): RetryConfig {\r\n  return {\r\n    maxRetries: 3,\r\n    baseDelay: 1000,\r\n    maxDelay: 30000,\r\n    backoffMultiplier: 2,\r\n  };\r\n}\r\n\r\n/**\r\n * Build HTTP config from SDK config\r\n */\r\nexport function buildHttpConfig(apiKey: string, baseUrl: string, timeout: number, retryConfig: RetryConfig): HttpConfig {\r\n  return {\r\n    apiKey,\r\n    baseUrl,\r\n    timeout,\r\n    retryConfig,\r\n  };\r\n}","/**\r\n * NFE.io SDK v3 - Service Invoices Resource\r\n * \r\n * Handles service invoice operations (NFS-e)\r\n * This is the core functionality of NFE.io API\r\n */\r\n\r\nimport type { \r\n  ServiceInvoice, \r\n  ServiceInvoiceData, \r\n  ListResponse, \r\n  PaginationOptions,\r\n  AsyncResponse\r\n} from '../types.js';\r\nimport type { HttpClient } from '../http/client.js';\r\nimport { InvoiceProcessingError } from '../errors/index.js';\r\n\r\n// ============================================================================\r\n// Service Invoices Resource\r\n// ============================================================================\r\n\r\nexport class ServiceInvoicesResource {\r\n  constructor(private readonly http: HttpClient) {}\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Core CRUD Operations\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Create a new service invoice\r\n   * Returns 202 + location for async processing (NFE.io pattern)\r\n   */\r\n  async create(\r\n    companyId: string, \r\n    data: ServiceInvoiceData\r\n  ): Promise<ServiceInvoice | AsyncResponse> {\r\n    const path = `/companies/${companyId}/serviceinvoices`;\r\n    const response = await this.http.post<ServiceInvoice | AsyncResponse>(path, data);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * List service invoices for a company\r\n   */\r\n  async list(\r\n    companyId: string, \r\n    options: PaginationOptions = {}\r\n  ): Promise<ListResponse<ServiceInvoice>> {\r\n    const path = `/companies/${companyId}/serviceinvoices`;\r\n    const response = await this.http.get<ListResponse<ServiceInvoice>>(path, options);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a specific service invoice\r\n   */\r\n  async retrieve(companyId: string, invoiceId: string): Promise<ServiceInvoice> {\r\n    const path = `/companies/${companyId}/serviceinvoices/${invoiceId}`;\r\n    const response = await this.http.get<ServiceInvoice>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Cancel a service invoice\r\n   */\r\n  async cancel(companyId: string, invoiceId: string): Promise<ServiceInvoice> {\r\n    const path = `/companies/${companyId}/serviceinvoices/${invoiceId}`;\r\n    const response = await this.http.delete<ServiceInvoice>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Email Operations\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Send invoice via email\r\n   */\r\n  async sendEmail(companyId: string, invoiceId: string): Promise<{ sent: boolean; message?: string }> {\r\n    const path = `/companies/${companyId}/serviceinvoices/${invoiceId}/sendemail`;\r\n    const response = await this.http.put<{ sent: boolean; message?: string }>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // File Downloads\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Download invoice PDF\r\n   */\r\n  async downloadPdf(companyId: string, invoiceId?: string): Promise<any> {\r\n    let path: string;\r\n    \r\n    if (invoiceId) {\r\n      path = `/companies/${companyId}/serviceinvoices/${invoiceId}/pdf`;\r\n    } else {\r\n      // Bulk download for company\r\n      path = `/companies/${companyId}/serviceinvoices/pdf`;\r\n    }\r\n    \r\n    const response = await this.http.get<any>(path);\r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Download invoice XML\r\n   */\r\n  async downloadXml(companyId: string, invoiceId?: string): Promise<any> {\r\n    let path: string;\r\n    \r\n    if (invoiceId) {\r\n      path = `/companies/${companyId}/serviceinvoices/${invoiceId}/xml`;\r\n    } else {\r\n      // Bulk download for company\r\n      path = `/companies/${companyId}/serviceinvoices/xml`;\r\n    }\r\n    \r\n    const response = await this.http.get<any>(path);\r\n    return response.data;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // High-level Convenience Methods\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Create invoice and wait for completion (handles async processing)\r\n   */\r\n  async createAndWait(\r\n    companyId: string, \r\n    data: ServiceInvoiceData,\r\n    options: { \r\n      maxAttempts?: number; \r\n      intervalMs?: number; \r\n      timeoutMs?: number \r\n    } = {}\r\n  ): Promise<ServiceInvoice> {\r\n    const { maxAttempts = 30, intervalMs = 2000, timeoutMs = 60000 } = options;\r\n    \r\n    // Create invoice\r\n    const createResult = await this.create(companyId, data);\r\n    \r\n    // If synchronous response (unusual for NFE.io), return immediately\r\n    if ('id' in createResult && createResult.id) {\r\n      return createResult as ServiceInvoice;\r\n    }\r\n    \r\n    // Handle async response (202 + location)\r\n    const asyncResult = createResult as AsyncResponse;\r\n    if (asyncResult.code !== 202 || !asyncResult.location) {\r\n      throw new InvoiceProcessingError(\r\n        'Unexpected response from invoice creation',\r\n        createResult\r\n      );\r\n    }\r\n    \r\n    // Poll for completion using the injected polling logic\r\n    return this.pollInvoiceCompletion(asyncResult.location, {\r\n      maxAttempts,\r\n      intervalMs,\r\n      timeoutMs,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get invoice status (high-level wrapper)\r\n   */\r\n  async getStatus(companyId: string, invoiceId: string): Promise<{\r\n    status: string;\r\n    invoice: ServiceInvoice;\r\n    isComplete: boolean;\r\n    isFailed: boolean;\r\n  }> {\r\n    const invoice = await this.retrieve(companyId, invoiceId);\r\n    \r\n    return {\r\n      status: invoice.status,\r\n      invoice,\r\n      isComplete: ['issued', 'completed'].includes(invoice.status),\r\n      isFailed: ['failed', 'cancelled', 'error'].includes(invoice.status),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Bulk operations: Create multiple invoices\r\n   */\r\n  async createBatch(\r\n    companyId: string,\r\n    invoices: ServiceInvoiceData[],\r\n    options: { \r\n      waitForCompletion?: boolean;\r\n      maxConcurrent?: number;\r\n    } = {}\r\n  ): Promise<Array<ServiceInvoice | AsyncResponse>> {\r\n    const { waitForCompletion = false, maxConcurrent = 5 } = options;\r\n    \r\n    // Process in batches to avoid overwhelming the API\r\n    const results: Array<ServiceInvoice | AsyncResponse> = [];\r\n    \r\n    for (let i = 0; i < invoices.length; i += maxConcurrent) {\r\n      const batch = invoices.slice(i, i + maxConcurrent);\r\n      \r\n      const batchPromises = batch.map(async (invoiceData) => {\r\n        if (waitForCompletion) {\r\n          return this.createAndWait(companyId, invoiceData);\r\n        } else {\r\n          return this.create(companyId, invoiceData);\r\n        }\r\n      });\r\n      \r\n      const batchResults = await Promise.all(batchPromises);\r\n      results.push(...batchResults);\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Private Helper Methods\r\n  // --------------------------------------------------------------------------\r\n\r\n  private async pollInvoiceCompletion(\r\n    locationUrl: string,\r\n    options: { maxAttempts: number; intervalMs: number; timeoutMs: number }\r\n  ): Promise<ServiceInvoice> {\r\n    const { maxAttempts, intervalMs, timeoutMs } = options;\r\n    const startTime = Date.now();\r\n    \r\n    for (let attempt = 0; attempt < maxAttempts; attempt++) {\r\n      // Check timeout\r\n      if (Date.now() - startTime > timeoutMs) {\r\n        throw new InvoiceProcessingError(\r\n          `Invoice processing timeout after ${timeoutMs}ms`,\r\n          { locationUrl, attempt, timeoutMs }\r\n        );\r\n      }\r\n      \r\n      // Wait before polling (except first attempt)\r\n      if (attempt > 0) {\r\n        await this.sleep(intervalMs);\r\n      }\r\n      \r\n      try {\r\n        // Extract path from location URL\r\n        const path = this.extractPathFromLocationUrl(locationUrl);\r\n        const response = await this.http.get<ServiceInvoice>(path);\r\n        const invoice = response.data;\r\n        \r\n        // Check if processing is complete\r\n        if (this.isInvoiceComplete(invoice)) {\r\n          return invoice;\r\n        }\r\n        \r\n        // Check if processing failed\r\n        if (this.isInvoiceFailed(invoice)) {\r\n          throw new InvoiceProcessingError(\r\n            `Invoice processing failed: ${invoice.status}`,\r\n            invoice\r\n          );\r\n        }\r\n        \r\n        // Continue polling\r\n        \r\n      } catch (error) {\r\n        // If it's the last attempt, throw the error\r\n        if (attempt === maxAttempts - 1) {\r\n          throw new InvoiceProcessingError(\r\n            'Failed to poll invoice completion',\r\n            { error, locationUrl, attempt }\r\n          );\r\n        }\r\n        \r\n        // For other attempts, continue (might be temporary issue)\r\n      }\r\n    }\r\n    \r\n    throw new InvoiceProcessingError(\r\n      `Invoice processing timeout after ${maxAttempts} polling attempts`,\r\n      { locationUrl, maxAttempts, intervalMs }\r\n    );\r\n  }\r\n\r\n  private extractPathFromLocationUrl(url: string): string {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      return urlObj.pathname + urlObj.search;\r\n    } catch {\r\n      // If URL parsing fails, assume it's already a path\r\n      return url.startsWith('/') ? url : `/${url}`;\r\n    }\r\n  }\r\n\r\n  private isInvoiceComplete(invoice: ServiceInvoice): boolean {\r\n    return ['issued', 'completed'].includes(invoice.status);\r\n  }\r\n\r\n  private isInvoiceFailed(invoice: ServiceInvoice): boolean {\r\n    return ['failed', 'cancelled', 'error'].includes(invoice.status);\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Factory Function\r\n// ============================================================================\r\n\r\nexport function createServiceInvoicesResource(http: HttpClient): ServiceInvoicesResource {\r\n  return new ServiceInvoicesResource(http);\r\n}","/**\r\n * NFE.io SDK v3 - Companies Resource\r\n * \r\n * Handles company operations and certificate management\r\n */\r\n\r\nimport type { \r\n  Company, \r\n  ListResponse, \r\n  PaginationOptions \r\n} from '../types.js';\r\nimport type { HttpClient } from '../http/client.js';\r\n\r\n// ============================================================================\r\n// Companies Resource\r\n// ============================================================================\r\n\r\nexport class CompaniesResource {\r\n  constructor(private readonly http: HttpClient) {}\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Core CRUD Operations\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Create a new company\r\n   */\r\n  async create(data: Omit<Company, 'id' | 'createdOn' | 'modifiedOn'>): Promise<Company> {\r\n    const path = '/companies';\r\n    const response = await this.http.post<Company>(path, data);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * List companies\r\n   */\r\n  async list(options: PaginationOptions = {}): Promise<ListResponse<Company>> {\r\n    const path = '/companies';\r\n    const response = await this.http.get<ListResponse<Company>>(path, options);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a specific company\r\n   */\r\n  async retrieve(companyId: string): Promise<Company> {\r\n    const path = `/companies/${companyId}`;\r\n    const response = await this.http.get<Company>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Update a company\r\n   */\r\n  async update(companyId: string, data: Partial<Company>): Promise<Company> {\r\n    const path = `/companies/${companyId}`;\r\n    const response = await this.http.put<Company>(path, data);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Delete a company (named 'remove' to avoid JS keyword conflict)\r\n   */\r\n  async remove(companyId: string): Promise<{ deleted: boolean; id: string }> {\r\n    const path = `/companies/${companyId}`;\r\n    const response = await this.http.delete<{ deleted: boolean; id: string }>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Certificate Management\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Upload digital certificate for a company\r\n   * Handles FormData for file upload\r\n   */\r\n  async uploadCertificate(\r\n    companyId: string, \r\n    certificateData: {\r\n      /** Certificate file (Buffer or Blob) */\r\n      file: any;\r\n      /** Certificate password */\r\n      password: string;\r\n      /** Optional filename */\r\n      filename?: string;\r\n    }\r\n  ): Promise<{ uploaded: boolean; message?: string }> {\r\n    const path = `/companies/${companyId}/certificate`;\r\n    \r\n    // Create FormData for file upload\r\n    const formData = this.createFormData();\r\n    \r\n    // Add certificate file\r\n    if (certificateData.filename) {\r\n      formData.append('certificate', certificateData.file, certificateData.filename);\r\n    } else {\r\n      formData.append('certificate', certificateData.file);\r\n    }\r\n    \r\n    // Add password\r\n    formData.append('password', certificateData.password);\r\n    \r\n    const response = await this.http.post<{ uploaded: boolean; message?: string }>(\r\n      path, \r\n      formData\r\n    );\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  /**\r\n   * Get certificate status for a company\r\n   */\r\n  async getCertificateStatus(companyId: string): Promise<{\r\n    hasCertificate: boolean;\r\n    expiresOn?: string;\r\n    isValid?: boolean;\r\n    details?: any;\r\n  }> {\r\n    const path = `/companies/${companyId}/certificate`;\r\n    const response = await this.http.get<{\r\n      hasCertificate: boolean;\r\n      expiresOn?: string;\r\n      isValid?: boolean;\r\n      details?: any;\r\n    }>(path);\r\n    \r\n    return response.data;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // High-level Convenience Methods\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Find company by CNPJ/CPF\r\n   */\r\n  async findByTaxNumber(taxNumber: number): Promise<Company | null> {\r\n    const companies = await this.list({ pageCount: 100 }); // Get reasonable batch\r\n    \r\n    return companies.data.find(company => \r\n      company.federalTaxNumber === taxNumber\r\n    ) || null;\r\n  }\r\n\r\n  /**\r\n   * Get companies with active certificates\r\n   */\r\n  async getCompaniesWithCertificates(): Promise<Company[]> {\r\n    const companies = await this.list({ pageCount: 100 });\r\n    \r\n    const companiesWithCerts: Company[] = [];\r\n    \r\n    // Check certificate status for each company\r\n    for (const company of companies.data) {\r\n      try {\r\n        const certStatus = await this.getCertificateStatus(company.id!);\r\n        if (certStatus.hasCertificate && certStatus.isValid) {\r\n          companiesWithCerts.push(company);\r\n        }\r\n      } catch {\r\n        // Skip companies where we can't check certificate status\r\n        continue;\r\n      }\r\n    }\r\n    \r\n    return companiesWithCerts;\r\n  }\r\n\r\n  /**\r\n   * Bulk create companies\r\n   */\r\n  async createBatch(\r\n    companies: Array<Omit<Company, 'id' | 'createdOn' | 'modifiedOn'>>,\r\n    options: { \r\n      maxConcurrent?: number;\r\n      continueOnError?: boolean;\r\n    } = {}\r\n  ): Promise<Array<Company | { error: string; data: any }>> {\r\n    const { maxConcurrent = 3, continueOnError = true } = options;\r\n    \r\n    const results: Array<Company | { error: string; data: any }> = [];\r\n    \r\n    // Process in batches to avoid overwhelming the API\r\n    for (let i = 0; i < companies.length; i += maxConcurrent) {\r\n      const batch = companies.slice(i, i + maxConcurrent);\r\n      \r\n      const batchPromises = batch.map(async (companyData) => {\r\n        try {\r\n          return await this.create(companyData);\r\n        } catch (error) {\r\n          if (continueOnError) {\r\n            return {\r\n              error: error instanceof Error ? error.message : 'Unknown error',\r\n              data: companyData\r\n            };\r\n          } else {\r\n            throw error;\r\n          }\r\n        }\r\n      });\r\n      \r\n      const batchResults = await Promise.all(batchPromises);\r\n      results.push(...batchResults);\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Private Helper Methods  \r\n  // --------------------------------------------------------------------------\r\n\r\n  private createFormData(): any {\r\n    if (typeof FormData !== 'undefined') {\r\n      return new FormData();\r\n    } else {\r\n      // Fallback for environments without FormData\r\n      throw new Error('FormData is not available in this environment');\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Factory Function\r\n// ============================================================================\r\n\r\nexport function createCompaniesResource(http: HttpClient): CompaniesResource {\r\n  return new CompaniesResource(http);\r\n}","/**\r\n * NFE.io SDK v3 - Resources Index\r\n * \r\n * Centralized exports for all API resources\r\n */\r\n\r\n// Resource classes\r\nexport { ServiceInvoicesResource, createServiceInvoicesResource } from './service-invoices.js';\r\nexport { CompaniesResource, createCompaniesResource } from './companies.js';\r\n\r\n// TODO: Add other resources\r\n// export { LegalPeopleResource, createLegalPeopleResource } from './legal-people.js';\r\n// export { NaturalPeopleResource, createNaturalPeopleResource } from './natural-people.js';\r\n// export { WebhooksResource, createWebhooksResource } from './webhooks.js';","/**\r\n * NFE.io SDK v3 - Main Client\r\n * \r\n * Modern TypeScript client for NFE.io API with zero runtime dependencies\r\n * Compatible with Node.js 18+ and any JavaScript environment\r\n */\r\n\r\nimport type { \r\n  NfeConfig, \r\n  RequiredNfeConfig, \r\n  ServiceInvoice, \r\n  PollOptions\r\n} from './types.js';\r\nimport { HttpClient, createDefaultRetryConfig, buildHttpConfig } from './http/client.js';\r\nimport { ErrorFactory, ConfigurationError, PollingTimeoutError } from './errors/index.js';\r\n\r\n// Resource imports\r\nimport { ServiceInvoicesResource, CompaniesResource } from './resources/index.js';\r\n\r\n// ============================================================================\r\n// Main NFE.io Client\r\n// ============================================================================\r\n\r\nexport class NfeClient {\r\n  private readonly http: HttpClient;\r\n  private readonly config: RequiredNfeConfig;\r\n\r\n  // Public resource interfaces (maintain v2 naming convention)\r\n  public readonly serviceInvoices: ServiceInvoicesResource;\r\n  public readonly companies: CompaniesResource;\r\n  // public readonly legalPeople: LegalPeopleResource;\r\n  // public readonly naturalPeople: NaturalPeopleResource;\r\n  // public readonly webhooks: WebhooksResource;\r\n\r\n  constructor(config: NfeConfig) {\r\n    // Validate and normalize configuration\r\n    this.config = this.validateAndNormalizeConfig(config);\r\n    \r\n    // Validate Node.js environment\r\n    this.validateEnvironment();\r\n    \r\n    // Create HTTP client\r\n    const httpConfig = buildHttpConfig(\r\n      this.config.apiKey,\r\n      this.getBaseUrl(),\r\n      this.config.timeout,\r\n      this.config.retryConfig\r\n    );\r\n    this.http = new HttpClient(httpConfig);\r\n\r\n    // Initialize resources\r\n    this.serviceInvoices = new ServiceInvoicesResource(this.http);\r\n    this.companies = new CompaniesResource(this.http);\r\n    // this.legalPeople = new LegalPeopleResource(this.http);\r\n    // this.naturalPeople = new NaturalPeopleResource(this.http);\r\n    // this.webhooks = new WebhooksResource(this.http);\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Configuration Management\r\n  // --------------------------------------------------------------------------\r\n\r\n  private validateAndNormalizeConfig(config: NfeConfig): RequiredNfeConfig {\r\n    if (!config.apiKey) {\r\n      // Try to get from environment variable\r\n      const envApiKey = this.getEnvironmentVariable('NFE_API_KEY');\r\n      if (!envApiKey) {\r\n        throw ErrorFactory.fromMissingApiKey();\r\n      }\r\n      config.apiKey = envApiKey;\r\n    }\r\n\r\n    // Normalize environment\r\n    const environment = config.environment || 'production';\r\n    if (!['production', 'sandbox'].includes(environment)) {\r\n      throw new ConfigurationError(\r\n        `Invalid environment: ${environment}. Must be 'production' or 'sandbox'.`,\r\n        { environment }\r\n      );\r\n    }\r\n\r\n    // Set defaults\r\n    const normalizedConfig: RequiredNfeConfig = {\r\n      apiKey: config.apiKey,\r\n      environment,\r\n      baseUrl: config.baseUrl || this.getDefaultBaseUrl(environment),\r\n      timeout: config.timeout || 30000,\r\n      retryConfig: config.retryConfig || createDefaultRetryConfig(),\r\n    };\r\n\r\n    return normalizedConfig;\r\n  }\r\n\r\n  private getDefaultBaseUrl(environment: 'production' | 'sandbox'): string {\r\n    const baseUrls = {\r\n      production: 'https://api.nfe.io/v1',\r\n      sandbox: 'https://api-sandbox.nfe.io/v1', // Adjust if sandbox exists\r\n    };\r\n    return baseUrls[environment];\r\n  }\r\n\r\n  private getBaseUrl(): string {\r\n    return this.config.baseUrl;\r\n  }\r\n\r\n  private getEnvironmentVariable(name: string): string | undefined {\r\n    // Safe access to process.env with fallback\r\n    try {\r\n      return (globalThis as any).process?.env?.[name];\r\n    } catch {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Environment Validation\r\n  // --------------------------------------------------------------------------\r\n\r\n  private validateEnvironment(): void {\r\n    // Check Node.js version (should support fetch natively)\r\n    this.validateNodeVersion();\r\n    \r\n    // Check fetch availability\r\n    if (typeof fetch === 'undefined') {\r\n      throw ErrorFactory.fromNodeVersionError(this.getNodeVersion());\r\n    }\r\n  }\r\n\r\n  private validateNodeVersion(): void {\r\n    const nodeVersion = this.getNodeVersion();\r\n    const majorVersion = this.extractMajorVersion(nodeVersion);\r\n    \r\n    if (majorVersion < 18) {\r\n      throw ErrorFactory.fromNodeVersionError(nodeVersion);\r\n    }\r\n  }\r\n\r\n  private getNodeVersion(): string {\r\n    try {\r\n      return (globalThis as any).process?.version || 'unknown';\r\n    } catch {\r\n      return 'unknown';\r\n    }\r\n  }\r\n\r\n  private extractMajorVersion(version: string): number {\r\n    const match = version.match(/^v?(\\d+)\\./);\r\n    return match ? parseInt(match[1]!, 10) : 0;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Public Utility Methods\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Update client configuration\r\n   */\r\n  public updateConfig(newConfig: Partial<NfeConfig>): void {\r\n    const mergedConfig = { ...this.config, ...newConfig };\r\n    const normalizedConfig = this.validateAndNormalizeConfig(mergedConfig);\r\n    \r\n    // Update internal config\r\n    Object.assign(this.config, normalizedConfig);\r\n    \r\n    // Recreate HTTP client with new config\r\n    const httpConfig = buildHttpConfig(\r\n      this.config.apiKey,\r\n      this.getBaseUrl(),\r\n      this.config.timeout,\r\n      this.config.retryConfig\r\n    );\r\n    Object.assign(this.http, new HttpClient(httpConfig));\r\n  }\r\n\r\n  /**\r\n   * Set timeout for requests (maintains v2 compatibility)\r\n   */\r\n  public setTimeout(timeout: number): void {\r\n    this.updateConfig({ timeout });\r\n  }\r\n\r\n  /**\r\n   * Set API key (maintains v2 compatibility)\r\n   */\r\n  public setApiKey(apiKey: string): void {\r\n    this.updateConfig({ apiKey });\r\n  }\r\n\r\n  /**\r\n   * Get current configuration (readonly)\r\n   */\r\n  public getConfig(): Readonly<RequiredNfeConfig> {\r\n    return { ...this.config };\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Polling Utility (for async invoice processing)\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Poll a resource until completion or timeout\r\n   * This is critical for NFE.io's async invoice processing (202 responses)\r\n   */\r\n  public async pollUntilComplete<T = ServiceInvoice>(\r\n    locationUrl: string, \r\n    options: PollOptions = {}\r\n  ): Promise<T> {\r\n    const { \r\n      maxAttempts = 30,\r\n      intervalMs = 2000 \r\n    } = options;\r\n    \r\n    for (let attempt = 0; attempt < maxAttempts; attempt++) {\r\n      // Wait before polling (except first attempt)\r\n      if (attempt > 0) {\r\n        await this.sleep(intervalMs);\r\n      }\r\n      \r\n      try {\r\n        // Extract path from full URL for HTTP client\r\n        const path = this.extractPathFromUrl(locationUrl);\r\n        const response = await this.http.get<any>(path);\r\n        \r\n        // Check completion status\r\n        if (this.isCompleteResponse(response.data)) {\r\n          return response.data as T;\r\n        }\r\n        \r\n        if (this.isFailedResponse(response.data)) {\r\n          throw new PollingTimeoutError(\r\n            `Resource processing failed: ${response.data.error || 'Unknown error'}`,\r\n            response.data\r\n          );\r\n        }\r\n        \r\n        // Continue polling if still in progress\r\n        \r\n      } catch (error) {\r\n        // If it's the last attempt, throw the error\r\n        if (attempt === maxAttempts - 1) {\r\n          throw error;\r\n        }\r\n        \r\n        // For other attempts, continue polling (might be temporary network issue)\r\n      }\r\n    }\r\n    \r\n    throw new PollingTimeoutError(\r\n      `Polling timeout after ${maxAttempts} attempts. Resource may still be processing.`,\r\n      { maxAttempts, intervalMs }\r\n    );\r\n  }\r\n\r\n  private extractPathFromUrl(url: string): string {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      return urlObj.pathname + urlObj.search;\r\n    } catch {\r\n      // If URL parsing fails, assume it's already a path\r\n      return url.startsWith('/') ? url : `/${url}`;\r\n    }\r\n  }\r\n\r\n  private isCompleteResponse(data: any): boolean {\r\n    return data && (\r\n      data.status === 'completed' || \r\n      data.status === 'issued' ||\r\n      (data.id && data.number && !data.status) // NFE.io completed invoices might not have explicit status\r\n    );\r\n  }\r\n\r\n  private isFailedResponse(data: any): boolean {\r\n    return data && (\r\n      data.status === 'failed' || \r\n      data.status === 'error' ||\r\n      data.error\r\n    );\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  // --------------------------------------------------------------------------\r\n  // Health Check & Debug\r\n  // --------------------------------------------------------------------------\r\n\r\n  /**\r\n   * Check if the client is properly configured and can reach the API\r\n   */\r\n  public async healthCheck(): Promise<{ status: 'ok' | 'error', details?: any }> {\r\n    try {\r\n      // Try to make a simple request (get companies list with pageCount=1)\r\n      await this.http.get('/companies', { pageCount: 1 });\r\n      return { status: 'ok' };\r\n    } catch (error) {\r\n      return { \r\n        status: 'error', \r\n        details: {\r\n          error: error instanceof Error ? error.message : 'Unknown error',\r\n          config: {\r\n            baseUrl: this.config.baseUrl,\r\n            environment: this.config.environment,\r\n            hasApiKey: !!this.config.apiKey,\r\n          }\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get client information for debugging\r\n   */\r\n  public getClientInfo(): {\r\n    version: string;\r\n    nodeVersion: string;\r\n    environment: string;\r\n    baseUrl: string;\r\n    hasApiKey: boolean;\r\n  } {\r\n    return {\r\n      version: '3.0.0-beta.1', // TODO: Read from package.json\r\n      nodeVersion: this.getNodeVersion(),\r\n      environment: this.config.environment,\r\n      baseUrl: this.config.baseUrl,\r\n      hasApiKey: !!this.config.apiKey,\r\n    };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Factory Functions (maintain v2 compatibility)\r\n// ============================================================================\r\n\r\n/**\r\n * Create NFE.io client instance (maintains v2 compatibility)\r\n * @param apiKey API key or full config object\r\n * @param version Ignored in v3 (maintained for compatibility)\r\n */\r\nexport function createNfeClient(apiKey: string | NfeConfig, _version?: string): NfeClient {\r\n  const config = typeof apiKey === 'string' ? { apiKey } : apiKey;\r\n  return new NfeClient(config);\r\n}\r\n\r\n/**\r\n * Default export factory function (maintains v2 compatibility)\r\n */\r\nexport default function nfe(apiKey: string | NfeConfig, _version?: string): NfeClient {\r\n  return createNfeClient(apiKey, _version);\r\n}\r\n\r\n// ============================================================================\r\n// Version Constants\r\n// ============================================================================\r\n\r\nexport const VERSION = '3.0.0-beta.1';\r\nexport const SUPPORTED_NODE_VERSIONS = '>=18.0.0';\r\nexport const DEFAULT_TIMEOUT = 30000;\r\nexport const DEFAULT_RETRY_ATTEMPTS = 3;","/**\r\n * NFE.io SDK v3 - Main Entry Point\r\n * \r\n * Modern TypeScript SDK for NFE.io API with zero runtime dependencies\r\n * Compatible with Node.js 18+ and any JavaScript runtime\r\n */\r\n\r\n// ============================================================================\r\n// Main Exports\r\n// ============================================================================\r\n\r\n// Core client\r\nexport { NfeClient, createNfeClient, VERSION, SUPPORTED_NODE_VERSIONS } from './core/client.js';\r\n\r\n// Types\r\nexport type {\r\n  // Configuration\r\n  NfeConfig,\r\n  RequiredNfeConfig,\r\n  RetryConfig,\r\n  \r\n  // Entities\r\n  Company,\r\n  LegalPerson,\r\n  NaturalPerson,\r\n  ServiceInvoice,\r\n  ServiceInvoiceData,\r\n  ServiceInvoiceBorrower,\r\n  ServiceInvoiceDetails,\r\n  ServiceInvoiceStatus,\r\n  Webhook,\r\n  WebhookEvent,\r\n  \r\n  // Common types\r\n  Address,\r\n  City,\r\n  EntityType,\r\n  TaxRegime,\r\n  SpecialTaxRegime,\r\n  \r\n  // HTTP and pagination\r\n  HttpResponse,\r\n  ListResponse,\r\n  PageInfo,\r\n  PaginationOptions,\r\n  PollOptions,\r\n  \r\n  // Utility types\r\n  ResourceId,\r\n  ApiErrorResponse,\r\n} from './core/types.js';\r\n\r\n// Error classes\r\nexport {\r\n  // Base error\r\n  NfeError,\r\n  \r\n  // HTTP errors\r\n  AuthenticationError,\r\n  ValidationError,\r\n  NotFoundError,\r\n  ConflictError,\r\n  RateLimitError,\r\n  ServerError,\r\n  \r\n  // Connection errors\r\n  ConnectionError,\r\n  TimeoutError,\r\n  \r\n  // SDK errors\r\n  ConfigurationError,\r\n  PollingTimeoutError,\r\n  InvoiceProcessingError,\r\n  \r\n  // Error factory\r\n  ErrorFactory,\r\n  \r\n  // Type guards\r\n  isNfeError,\r\n  isAuthenticationError,\r\n  isValidationError,\r\n  isNotFoundError,\r\n  isConnectionError,\r\n  isTimeoutError,\r\n  isPollingTimeoutError,\r\n  \r\n  // Legacy aliases (v2 compatibility)\r\n  BadRequestError,\r\n  APIError,\r\n  InternalServerError,\r\n  \r\n  // Error types\r\n  ErrorTypes,\r\n  type ErrorType,\r\n} from './core/errors/index.js';\r\n\r\n// ============================================================================\r\n// Default Export (maintains v2 compatibility)\r\n// ============================================================================\r\n\r\n// Allow both ES modules and CommonJS usage:\r\n// import nfe from '@nfe-io/sdk'\r\n// const nfe = require('@nfe-io/sdk')\r\nimport nfeFactory from './core/client.js';\r\nexport default nfeFactory;\r\n\r\n// ============================================================================\r\n// Package Information\r\n// ============================================================================\r\n\r\nexport const PACKAGE_NAME = '@nfe-io/sdk';\r\nexport const PACKAGE_VERSION = '3.0.0-beta.1';\r\nexport const API_VERSION = 'v1';\r\nexport const REPOSITORY_URL = 'https://github.com/nfe/client-nodejs';\r\nexport const DOCUMENTATION_URL = 'https://nfe.io/docs';\r\n\r\n// ============================================================================\r\n// Environment Detection & Utilities\r\n// ============================================================================\r\n\r\n/**\r\n * Check if the current environment supports NFE.io SDK v3\r\n */\r\nexport function isEnvironmentSupported(): {\r\n  supported: boolean;\r\n  nodeVersion?: string;\r\n  hasFetch: boolean;\r\n  hasAbortController: boolean;\r\n  issues: string[];\r\n} {\r\n  const issues: string[] = [];\r\n  let nodeVersion: string | undefined;\r\n  \r\n  // Check Node.js version\r\n  try {\r\n    nodeVersion = (globalThis as any).process?.version;\r\n    if (nodeVersion) {\r\n      const majorVersion = parseInt(nodeVersion.slice(1).split('.')[0]!);\r\n      if (majorVersion < 18) {\r\n        issues.push(`Node.js ${majorVersion} is not supported. Requires Node.js 18+.`);\r\n      }\r\n    }\r\n  } catch {\r\n    issues.push('Unable to detect Node.js version');\r\n  }\r\n  \r\n  // Check fetch support\r\n  const hasFetch = typeof fetch !== 'undefined';\r\n  if (!hasFetch) {\r\n    issues.push('Fetch API not available');\r\n  }\r\n  \r\n  // Check AbortController support\r\n  const hasAbortController = typeof AbortController !== 'undefined';\r\n  if (!hasAbortController) {\r\n    issues.push('AbortController not available');\r\n  }\r\n  \r\n  const result: {\r\n    supported: boolean;\r\n    nodeVersion?: string;\r\n    hasFetch: boolean;\r\n    hasAbortController: boolean;\r\n    issues: string[];\r\n  } = {\r\n    supported: issues.length === 0,\r\n    hasFetch,\r\n    hasAbortController,\r\n    issues,\r\n  };\r\n  \r\n  if (nodeVersion) {\r\n    result.nodeVersion = nodeVersion;\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Get SDK runtime information\r\n */\r\nexport function getRuntimeInfo(): {\r\n  sdkVersion: string;\r\n  nodeVersion: string;\r\n  platform: string;\r\n  arch: string;\r\n  environment: 'node' | 'browser' | 'unknown';\r\n} {\r\n  let nodeVersion = 'unknown';\r\n  let platform = 'unknown';\r\n  let arch = 'unknown';\r\n  let environment: 'node' | 'browser' | 'unknown' = 'unknown';\r\n  \r\n  try {\r\n    const process = (globalThis as any).process;\r\n    if (process) {\r\n      nodeVersion = process.version || 'unknown';\r\n      platform = process.platform || 'unknown';\r\n      arch = process.arch || 'unknown';\r\n      environment = 'node';\r\n    } else if (typeof window !== 'undefined') {\r\n      environment = 'browser';\r\n      platform = navigator.platform || 'unknown';\r\n    }\r\n  } catch {\r\n    // Safe fallback\r\n  }\r\n  \r\n  return {\r\n    sdkVersion: PACKAGE_VERSION,\r\n    nodeVersion,\r\n    platform,\r\n    arch,\r\n    environment,\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// Quick Start Helpers\r\n// ============================================================================\r\n\r\n/**\r\n * Quick start: Create client from environment variable\r\n * Reads NFE_API_KEY from environment variables\r\n */\r\nexport function createClientFromEnv(environment?: 'production' | 'sandbox') {\r\n  const apiKey = (globalThis as any).process?.env?.NFE_API_KEY;\r\n  if (!apiKey) {\r\n    const { ConfigurationError } = require('./core/errors');\r\n    throw new ConfigurationError(\r\n      'NFE_API_KEY environment variable is required when using createClientFromEnv()'\r\n    );\r\n  }\r\n  \r\n  const { NfeClient } = require('./core/client');\r\n  return new NfeClient({ \r\n    apiKey, \r\n    environment: environment || 'production' \r\n  });\r\n}\r\n\r\n/**\r\n * Quick start: Validate API key format\r\n */\r\nexport function validateApiKeyFormat(apiKey: string): {\r\n  valid: boolean;\r\n  issues: string[];\r\n} {\r\n  const issues: string[] = [];\r\n  \r\n  if (!apiKey) {\r\n    issues.push('API key is required');\r\n  } else {\r\n    if (apiKey.length < 10) {\r\n      issues.push('API key appears to be too short');\r\n    }\r\n    \r\n    if (apiKey.includes(' ')) {\r\n      issues.push('API key should not contain spaces');\r\n    }\r\n    \r\n    // Add more validation rules as needed\r\n  }\r\n  \r\n  return {\r\n    valid: issues.length === 0,\r\n    issues,\r\n  };\r\n}"]}