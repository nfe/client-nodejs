# Spec: Code Generation from OpenAPI

**Capability**: `code-generation`  
**Related Change**: `generate-sdk-from-openapi`  

---

## ADDED Requirements

### Requirement: Generate TypeScript types from OpenAPI specs

The system SHALL provide automated TypeScript type generation from OpenAPI 3.0 specification files.

**Priority**: Critical  
**Scope**: Foundation

#### Scenario: Developer runs manual generation command

**Given** OpenAPI spec files exist in `openapi/spec/` directory  
**And** the spec `nf-servico-v1.yaml` contains valid OpenAPI 3.0 schema  
**When** developer runs `npm run generate`  
**Then** TypeScript type file is created at `src/generated/nf-servico.ts`  
**And** the generated file includes type definitions for all schemas, paths, and operations  
**And** the generated file contains a warning banner "⚠️ AUTO-GENERATED - DO NOT EDIT"  
**And** the command completes with exit code 0  
**And** success message is logged to console

#### Scenario: Generation handles multiple OpenAPI specs

**Given** 12 OpenAPI spec files exist in `openapi/spec/`:
- nf-servico-v1.yaml
- nf-produto-v2.yaml  
- nf-consumidor-v2.yaml
- consulta-cnpj.yaml
- consulta-cte-v2.yaml
- consulta-endereco.yaml
- consulta-nf-consumidor.yaml
- consulta-nf.yaml
- consulta-nfe-distribuicao-v1.yaml
- cpf-api.yaml
- calculo-impostos-v1.yaml
- nfeio.yaml

**When** developer runs `npm run generate`  
**Then** 12 separate TypeScript files are created in `src/generated/`  
**And** each file is named after its source spec (e.g., `nf-servico.ts`, `nf-produto.ts`)  
**And** a unified index file `src/generated/index.ts` is created with re-exports  
**And** all generated files compile without TypeScript errors

#### Scenario: Generated types are namespaced to avoid conflicts

**Given** multiple specs define a `Company` schema with different fields  
**When** types are generated  
**Then** types are exported in namespaces (e.g., `NfServico.components.schemas.Company`)  
**And** the unified index exports namespace modules: `export * as NfServico from './nf-servico'`  
**And** common types are aliased for convenience: `export type Company = NfServico.components.schemas.Company`

---

### Requirement: Provide watch mode for development workflow

The system SHALL support automatic regeneration of types when OpenAPI specs change.

**Priority**: Medium  
**Scope**: Developer Experience

#### Scenario: Watch mode regenerates on file changes

**Given** watch mode is started with `npm run generate:watch`  
**When** developer modifies `openapi/spec/nf-servico-v1.yaml`  
**Then** types are automatically regenerated within 2 seconds  
**And** console shows "Regenerating types for nf-servico-v1.yaml..."  
**And** console shows "✓ Types regenerated successfully"  
**And** TypeScript compiler picks up new types immediately

#### Scenario: Watch mode debounces rapid changes

**Given** watch mode is running  
**When** developer makes 5 changes to a spec within 1 second  
**Then** regeneration is triggered only once  
**And** generation waits for 500ms of inactivity before running

---

### Requirement: Generate metadata and provenance information

Generated files SHALL include metadata about their source and generation timestamp.

**Priority**: Low  
**Scope**: Maintainability

#### Scenario: Generated file includes source attribution

**Given** types are generated from `openapi/spec/nf-servico-v1.yaml`  
**When** developer opens `src/generated/nf-servico.ts`  
**Then** file header contains:
```typescript
/**
 * ⚠️ AUTO-GENERATED from openapi/spec/nf-servico-v1.yaml
 * Do not edit this file directly.
 * 
 * To regenerate: npm run generate
 * Last generated: 2026-01-10T10:30:00Z
 * Generator: openapi-typescript@6.7.0
 */
```

---

## MODIFIED Requirements

_No existing requirements modified by this capability._

---

## REMOVED Requirements

_No existing requirements removed by this capability._

---

## Cross-References

- **Depends on**: `spec-validation` - Must validate specs before generation
- **Enables**: `build-integration` - Generated types used in build pipeline
- **Related**: Future runtime validation with Zod schemas
